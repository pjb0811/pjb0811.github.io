{"data":{"site":{"siteMetadata":{"title":"pjb0811.github.io","author":"Jeongbin Park","description":"프론트엔드 웹 개발 기술 블로그","siteUrl":"https://pjb0811.github.io"}},"markdownRemark":{"id":"79205b8a-3852-557b-af40-792293a0d75d","excerpt":"이번 파트는 비동기 데이터 요청에 대한 SSR 설정에 대한 내용을 정리했다. SPA…","html":"<blockquote>\n<p>이번 파트는 비동기 데이터 요청에 대한 SSR 설정에 대한 내용을 정리했다. SPA 환경에서 비동기로 응답받은 데이터를 서버와 클라이언트 영역에서 어떻게 처리했는지에 대한 내용을 정리했다. 이번 글 역시 스스로의 학습 내용을 정리하는 글이기 때문에 편한 말투로 작성했다.</p>\n</blockquote>\n<h2>AJAX</h2>\n<p>우선 프론트엔드 영역에서의 비동기 처리를 통한 데이터의 활용은 매우 중요한 영역이 되었다. 흔히 <code class=\"language-text\">AJAX(Asynchronous JavaScript And XML)</code>로 표현되며 사전적 의미로는 비동기 자바스크립트와 XML을 말한다. 간단히 요약하자면 서버와 통신하기 위해 <code class=\"language-text\">XMLHttpRequest</code>객체를 사용하는 것을 말하며 JSON, XML, HTML, 일반 텍스트 형식 등을 포함한 다양한 포맷을 주고 받을 수 있다.</p>\n<p>무엇보다 가장 중요한 장점은 페이지 전체를 새로고침하지 않고서도 수행 되는 <strong>비동기성</strong>이다. 이 기능을 통해 서버 렌더링을 거치지 않고 클라이언트 렌더링을 통해 데이터를 전달받고 화면의 일부 영역을 새로 구성할 수 있으며 이는 프론트엔드의 개발에 있어 매우 중요한 기능이라 할 수 있다.</p>\n<p>이렇게 비동기로 요청하고 응답받은 데이터를 SPA 환경의 프로젝트에서 어떻게 활용할 수 있는지 정리했다.</p>\n<h2>Client</h2>\n<p>우선 비동기 통신을 위한 라이브러리 설치 및 비동기 요청을 처리하기 위한 파일을 하나 만들자. 이 파일은 클라이언트뿐만 아니라 서버 실행 시에도 사용하게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">yarn add --dev axios</code></pre></div>\n<p>비동기 통신과 관련하여 <code class=\"language-text\">axios</code>라는 라이브러러를 사용했다. 앞서 언급한 <code class=\"language-text\">XMLHttpRequest</code>를 활용하거나 <code class=\"language-text\">Fetch API</code>를 사용하여 비동기 통신을 처리해줘도 되지만 이를 좀 더 쉽게 활용하기 위해 라이브러리의 도움을 받기로 했다.</p>\n<ul>\n<li><code class=\"language-text\">src/lib/loadData.js</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> path <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`https://jsonplaceholder.typicode.com</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>path<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span>data\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">lib</code> 폴더에 <code class=\"language-text\">loadData.js</code>라는 파일을 만들고 비동기 요청을 위한 함수를 만들었다. 해당 함수는 비동기 요청에 필요한 api 주소의 일부를 인수로 전달받은 후 GET 방식을 통한 응답 데이터를 반환하게 된다. 비동기 처리방식이기 때문에 <code class=\"language-text\">async</code> 함수로 구현되어 있다. 비동기 통신의 경우 예외처리를 위해 <code class=\"language-text\">try/catch</code>을 활용해주는 경우도 있지만 이 번 예제에서는 따로 처리하지 않았다.</p>\n<ul>\n<li><code class=\"language-text\">src/components/Posts.jsx</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> withLayout <span class=\"token keyword\">from</span> <span class=\"token string\">'./withLayout'</span>\n<span class=\"token keyword\">import</span> loadData <span class=\"token keyword\">from</span> <span class=\"token string\">'../lib/loadData'</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Posts</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> url <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>match\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadData</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      data<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state\n\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">withLayout</span><span class=\"token punctuation\">(</span>Posts<span class=\"token punctuation\">)</span></code></pre></div>\n<p>비동기 통신 함수를 사용하기 위해 <code class=\"language-text\">Posts.jsx</code> 파일을 수정했다. 우선 이 전에 라우터 매개변수를 확인하기 위한 코드는 지운 후 <code class=\"language-text\">componentDidMount</code> 함수 호출 시 <code class=\"language-text\">loadData</code> 함수를 호출하도록 수정했다. 비동기로 응답받은 데이터는 <code class=\"language-text\">state</code>에 설정한뒤 <code class=\"language-text\">render</code> 함수 호출 시 해당 데이터를 화면에 그려주도록 수정했다.</p>\n<p>클라이언트 영역의 비동기 데이터 처리는 이 정도면 완료된 것 같다. 개발 서버를 실행한 후 화면을 확인해보자.</p>\n<p><img src=\"/async-client-ef5f6c61ac0c5c6eb64d4cf651027ae5.gif\" alt=\"async-client\"></p>\n<p>페이지 이동 시 전달받은 url를 바탕으로 비동기로 전달받은 데이터를 화면에 그려준다. 클라이언트 환경에서의 비동기 통신은 완료되었으니 서버 환경에서의 비동기 통신 방법에 대해 확인해보자.</p>\n<h2>Server</h2>\n<p>앞서 구현한 <code class=\"language-text\">loadData</code> 함수를 서버측에서 실행하기 위해 <code class=\"language-text\">routes.js</code> 파일의 코드를 수정한다.</p>\n<ul>\n<li><code class=\"language-text\">src/lib/routes.js</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> loadData <span class=\"token keyword\">from</span> <span class=\"token string\">'./loadData'</span>\n\n<span class=\"token keyword\">const</span> Routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/posts/:id'</span><span class=\"token punctuation\">,</span>\n    component<span class=\"token punctuation\">:</span> <span class=\"token function\">Loadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../components/Posts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    loadData<span class=\"token punctuation\">:</span> <span class=\"token keyword\">async</span> path <span class=\"token operator\">=></span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadData</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/posts'</span><span class=\"token punctuation\">,</span>\n    component<span class=\"token punctuation\">:</span> <span class=\"token function\">Loadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../components/Posts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    loadData<span class=\"token punctuation\">:</span> <span class=\"token keyword\">async</span> path <span class=\"token operator\">=></span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadData</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p><code class=\"language-text\">Posts</code> 컴포넌트를 전달받는 <code class=\"language-text\">Route</code> 컴포넌트에 <code class=\"language-text\">loadData</code> 함수를 props로 추가했다. 서버 환경에서 <code class=\"language-text\">renderer</code> 함수 호출 시 현재 라우터 목록에서 <code class=\"language-text\">loadData</code> 함수를 props 전달받는 페이지를 찾은 후 해당 컴포넌트로 데이터를 전달할 수 있도록 하기 위함이다.</p>\n<p>직접 서버 환경에서 url에 따라 비동기 통신을 해줘도 되지만 그럴 경우 서버측의 관리 포인트가 늘어난 불필요한 작업이 될 수도 있기 때문에 <code class=\"language-text\">routes.js</code> 파일을 활용할 수 있도록 했다.</p>\n<ul>\n<li><code class=\"language-text\">src/lib/renderer.js</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> StaticRouter<span class=\"token punctuation\">,</span> matchPath <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router-dom'</span>\n<span class=\"token keyword\">import</span> routes <span class=\"token keyword\">from</span> <span class=\"token string\">'./routes'</span>\n\n<span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> req<span class=\"token punctuation\">,</span> html <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> currentRoute <span class=\"token operator\">=</span> routes<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>route <span class=\"token operator\">=></span> <span class=\"token function\">matchPath</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span> route<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> currentRoute<span class=\"token punctuation\">.</span>loadData\n    <span class=\"token operator\">?</span> <span class=\"token keyword\">await</span> currentRoute<span class=\"token punctuation\">.</span><span class=\"token function\">loadData</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">:</span> <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">let</span> modules <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">renderToString</span><span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Loadable<span class=\"token punctuation\">.</span>Capture report<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>moduleName <span class=\"token operator\">=></span> modules<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>moduleName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>StaticRouter location<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">}</span> context<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>context<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>StaticRouter<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Loadable<span class=\"token punctuation\">.</span>Capture<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">let</span> bundles <span class=\"token operator\">=</span> <span class=\"token function\">getBundles</span><span class=\"token punctuation\">(</span>stats<span class=\"token punctuation\">,</span> modules<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    html<span class=\"token punctuation\">:</span> html\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;div id=\"root\">&lt;/div>'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token string\">`&lt;div id=\"root\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>app<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/div>`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'&lt;/body>'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>bundles\n          <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>bundle <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>bundle<span class=\"token punctuation\">.</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.map'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>bundle <span class=\"token operator\">=></span> `<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span>\"$<span class=\"token punctuation\">{</span>bundle<span class=\"token punctuation\">.</span>publicPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\">&lt;/script>`</span></span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>`\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    context<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>요청받은 url에 매치되는 컴포넌트를 찾을 수 있도록 <code class=\"language-text\">react-router-dom</code>에서 제공하는 <code class=\"language-text\">matchPath</code> 함수를 추가했다. 그리고 라우터 목록을 확인하기 위해 <code class=\"language-text\">routes.js</code>를 가져오도록 했다.</p>\n<p>이 후 <code class=\"language-text\">renderer</code> 함수 호출 시 요청받은 url과 라우터 목록을 통해 현재 페이지에 전달할 비동기 데이터를 가져오도록 설정했다. 응답받은 데이터는 <code class=\"language-text\">context</code> 객체의 프로퍼티로 추가한 뒤 <code class=\"language-text\">StaticRouter</code>의 props로 전달하도록 했다.</p>\n<ul>\n<li><code class=\"language-text\">src/components/Posts.jsx</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Posts</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> staticContext <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      data<span class=\"token punctuation\">:</span> staticContext <span class=\"token operator\">?</span> staticContext<span class=\"token punctuation\">.</span>data <span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> url <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>match\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadData</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      data<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 서버에서 <code class=\"language-text\">Posts</code> 컴포넌트 호출 시 생성자 함수에서 props를 통해 전달받은 비동기 데이터 값을 확인한 후 state에 할당하도록 수정했다. 이후 클라이언트에서 <code class=\"language-text\">Posts</code> 컴포넌트 호출 시에는 props로 데이터를 전달받지 않기 때문에 이 전과 같이 <code class=\"language-text\">componentDidMount</code> 에서 데이터를 응답받도록 했다.</p>\n<p>이제 서버 환경에서의 비동기 데이터 처리도 구현했으니 운영 서버 실행 후 페이지 소스를 확인해보자.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d81ceba17ea2239877d3f1c9481522a2/7699a/async-server-src.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 88.85191347753744%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACp0lEQVQ4y6VUiXKjMAzl/3+vadoAgQAhHOEwh23M9VY2Ic3sbjs7s84Iy7KtSHpPttZ1Rdf1qOsaUXwzEicpgijGyXbhej78IMIlvCIvSvRCou35t2IJ3sFxHDjuGTbNn6cT6S5OJxuH93ez9/H5Cdu2EUURuBBYlpVk+atYXdOhb3vwlqFreoxqNBvzPJtZZ7AdXjGOI6ZpMrbvxOKMQ1QcQ1tB8Iku4p8G3X3I7mzTrWme0FwbdEkLyTL0VQlWD6irAeNAUdL+NM6gTDEMgJR0maL9bljzMqPPepRehto/4BYwHD8Y1YtsSY4mOiIPUry9cRwOHc6OQJ4KtK1C0ygCU6GiP99145DnHKWbITt/4HK+43i843ap0cQR8qiEc2TkSMKxBTqKnpKjGq+mrnp+1S0NAr/3aCnlnmDnggAiGk1cYZajSeOHDP9MWQ0K7Y2cZQ36vANLezSsQc1qtF2HsixJCqpphTynEjRUb7Jr3mq9oD3BBES5gWtAGQndimpYhiGqNAOvcjpUYpLThujjt3PtlSbP9bKJpbmlh76skV4I0WkQJAo6es57LAPxUs0vlPlyiN/KYWmi7kZZC7CwAbu6qK83nN0JkXeHbzsoAoqawFPt8AM314fDx5BMErItAeSjihJqQSCOZrh2jIuXkK1CGRVgBSNeCiipTGaT+uqeZ8p68KI3nORFjDYrEYVAkqy4+AvCcME95YivV4RBSOuQ9Bh1Qh1254TDaDJ9RqgL2lLHqI5qpwbTt5IiGAatT0YUUUyvN9tIa9qns2aWm81ijG0UaBuk1BFZmCKiKHzfRxAET9Evze1GdT2fzVrTabd7nmfOp2kKS0oJTR39SNy93NRFU2F/WfSroyPYdW3fXyI9a/vrWUt/NCWakGESE/53/AJKimxzb9GaOwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"async-server-src\"\n        title=\"\"\n        src=\"/static/d81ceba17ea2239877d3f1c9481522a2/fb8a0/async-server-src.png\"\n        srcset=\"/static/d81ceba17ea2239877d3f1c9481522a2/1a291/async-server-src.png 148w,\n/static/d81ceba17ea2239877d3f1c9481522a2/2bc4a/async-server-src.png 295w,\n/static/d81ceba17ea2239877d3f1c9481522a2/fb8a0/async-server-src.png 590w,\n/static/d81ceba17ea2239877d3f1c9481522a2/526de/async-server-src.png 885w,\n/static/d81ceba17ea2239877d3f1c9481522a2/fa2eb/async-server-src.png 1180w,\n/static/d81ceba17ea2239877d3f1c9481522a2/7699a/async-server-src.png 1202w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>서버 요청 시에도 정상적으로 비동기 데이터를 화면에 그려주고 있다. 실제 실행화면도 문제없이 동작하는지 확인해보자</p>\n<p><img src=\"/async-server-2dbae384f0b5fbe4ef88c1e7f3e7d216.gif\" alt=\"async-server\"></p>\n<p>문제없이 동작은 하는데 조금 신경쓰이는 부분이 있다. 우선 서버 측에서 전달받은 비동기 데이터를 렌더링한 뒤 이후 클라이언트 측 컴포넌트에서 비동기 데이터를 다시 요청하기 때문에 불필요한 비동기 요청이 생기고 있다. 또한 서버에서 렌더링 된 영역을 클라이언트에서 다시 렌더링하기 때문에 해당 영역이 깜박이는 현상이 발생한다. 이 부분을 해결하기 위해 클라이언트 측 컴포넌트에서 서버에서 전달받은 비동기 데이터를 확인할 수 있도록 수정해보자.</p>\n<ul>\n<li><code class=\"language-text\">src/lib/renderer.js</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> serialize <span class=\"token keyword\">from</span> <span class=\"token string\">'serialize-javascript'</span>\n\n<span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> req<span class=\"token punctuation\">,</span> html <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    html<span class=\"token punctuation\">:</span> html\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'&lt;div id=\"root\">&lt;/div>'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token template-string\"><span class=\"token string\">`&lt;div id=\"root\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>app<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/div>\n        &lt;script>window.__ROUTE_DATA__ = </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/script>`</span></span>\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'&lt;/body>'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>bundles\n          <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>bundle <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>bundle<span class=\"token punctuation\">.</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.map'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>bundle <span class=\"token operator\">=></span> `<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span>\"$<span class=\"token punctuation\">{</span>bundle<span class=\"token punctuation\">.</span>publicPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\">&lt;/script>`</span></span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>`\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    context<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>서버 측에서 렌더링한 이후 클라이언트 컴포넌트에서 비동기 데이터를 확인해기 위해 <code class=\"language-text\">window.__ROUTE_DATA__</code>라는 전역 객체를 만들어줬다. <code class=\"language-text\">JSON.stringify</code> 함수를 활용해 객체를 만들수도 있지만 데이터 종류에 따라 에러가 날 수도 있기 때문에 <code class=\"language-text\">serialize-javascript</code> 라이브러리를 활용했다. 이제 <code class=\"language-text\">window</code> 에 추가된 <code class=\"language-text\">__ROUTE_DATA__</code> 데이터를 클라이언트 영역에서 확인하도록 수정해보자.</p>\n<ul>\n<li><code class=\"language-text\">src/components/Posts.jsx</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Posts</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> staticContext <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      data<span class=\"token punctuation\">:</span> staticContext <span class=\"token operator\">?</span> staticContext<span class=\"token punctuation\">.</span>data <span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> url <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>match\n    <span class=\"token keyword\">let</span> data\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>__ROUTE_DATA__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      data <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>__ROUTE_DATA__\n      window<span class=\"token punctuation\">.</span>__ROUTE_DATA__ <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadData</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      data<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">componentDidMount</code> 호출 시 <code class=\"language-text\">__ROUTE_DATA__</code> 객체 여부에 대한 비동기 요청 조건을 추가했다. 서버에서 생성한 <code class=\"language-text\">__ROUTE_DATA__</code>가 있는 경우 해당 객체를 <code class=\"language-text\">state</code>에 설정한 뒤 객체를 초기화하도록 했다. 이 후 페이지 이동 시에는 서버에서 렌더링을 하지 않기 때문에 비동기 요청 함수를 요청하도록 수정했다.</p>\n<p>이제 수정한 내용이 정상적으로 반영되는지 화면을 확인해보자.</p>\n<p><img src=\"/async-server-window-efb84ee977f89ac9aaef5d7bed541a6f.gif\" alt=\"async-server-window\"></p>\n<p>페이지 요청 시 서버 렌더링 후 클라이언트 컴포넌트에서는 서버 측에서 생성한 <code class=\"language-text\">__ROUTE_DATA__</code> 데이터를 렌더링하기 때문에 불필요한 비동기 요청과 그에 따른 렌더링 영역이 깜박이는 현상도 수정했다.</p>\n<h2>다음 과제</h2>\n<p>지금까지 SPA 개발환경에서 비동기 데이터를 처리하는 방법에 대한 내용들을 정리했다. 다음은 전역 상태 관리 라이브러리(<code class=\"language-text\">redux</code>, <code class=\"language-text\">mobx</code>)를 SPA 환경에서 활용하는 방법에 대한 내용을 정리하고자 한다.</p>","frontmatter":{"title":"React를 활용한 isomorphic SPA 개발하기 - 4부","date":"2018.12.25","tags":["react"],"translation":null,"mainImage":{"childImageSharp":{"sizes":{"aspectRatio":2.1666666666666665,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACCUlEQVQoz2NgIBJ4JPWAaSP/CvwKdT1ymYx8S3gYGHh5GRhYeRkk/Hi59RJ5mdXjgHwnXgbBIL7Cjg3MILXG/lUM+t5FDIa+pWCDTQKqGUyDahnMQxoYLEKbGawi2hkYNJ1T5TWc018WNM/+mNc0+711WNUHq7DqD9YRdR8Cs3rfBOdO/K/jW9UBMjC/cR7Lmu2HGEMzWxgj8zoZi5pnM+Y3zWZMLu5j1AxtYRTtvARSJsuoahd7Zdrc9f83bNr3f8Wanf9nzt/wf+2G/f+nzl73v7J1/n91u/TH777+ZyE2eBgUfNMSNYs7Ppg0Tn3q1D3/uWvvouduvUueWzbOeW5UM/upYnLHV1WHtL1+qa3LnWPqVxv4FK/S9SpeZR1Wt8o4oHqVbWTzWrPQpoWydQfEEKb+/8/J8OU/N8OFN1wM+55wM+x4ys1w6S8vUJyBfedTNzm/0v/L1uz+v2bb0f/dM9f9n7505/9pi7f/37z37P/ixjn/1WMn/+ea912PgeHpYwY/Ql74/59RPmfapYii7v/RFZP+ZTbP/t89b9N/z4yO/4XdS/+FF036L5665BxIHVi9SEkbA++cVQy88zcy8M3ZyMA/ezMD/8ytDPyz9jCwtWyBKJr9TIOh8pg/Q+4hT6a6U14e8296MeSd92JIOezJUHbZn3XqFw2iw5ghrp8oZbIl2xkABrzQdQhrj68AAAAASUVORK5CYII=","sizes":"(max-width: 1040px) 100vw, 1040px","src":"/static/d7907183959a1b5daf88f0ca71f52fef/5c809/async.png","srcSet":"/static/d7907183959a1b5daf88f0ca71f52fef/8235c/async.png 300w,\n/static/d7907183959a1b5daf88f0ca71f52fef/b61bb/async.png 600w,\n/static/d7907183959a1b5daf88f0ca71f52fef/5c809/async.png 1040w"}}}}}},"pageContext":{"slug":"/development-isomorphic-spa-using-react-part4/","previous":{"id":"d6222382-550a-5e72-b732-6628f0ab05a0","excerpt":"react 를 활용한 isomorphic SPA 개발에 대한 내용을 정리한 글이다. 이 번 글은 코드 스플리팅에 관한 내용이다. 이 번 포스팅을 포함한 SPA…","frontmatter":{"title":"React를 활용한 isomorphic SPA 개발하기 - 3부","date":"2018.12.24","tags":["react"],"translation":null,"mainImage":{"childImageSharp":{"sizes":{"aspectRatio":3.894967177242888,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAABMUlEQVQY0y2JvU7CUACF+wgOjs46OEFMdJCFEXVx0ZgQF2N8BycWn4BXQOtPFJRQMVaEGKUDRFMsLVBvyaV/oT8UuIAt9Spg8uXkfOcQ/XMwymvoDvZL7WHZGJwBRAL0pqOK6cL+8EEege7gRfOedRd0UUEdpCHiTFdwUAIQyhwpLpDiQQ4c5mEgJe4/gVBaibNKrGQnGl+7j/W1pBym1HWqFkqp4SyYPwUxpndSqW3fE3Iw2dyglB1aimTg4hWM0spx0SrA3lFRjeaamxl+mZRXb8HKNR+8bAVuwNKFGslqW9nWHk3wDacu2OyrxnNWre6I76bUQnL7W6x2BEZnmTYvdaucLXB2U0Xch8F92kLZYBm9yujE+AeP8QR/mn/qTZktHv5/Z+pibHnY8XHHn/RfeADxWR3MQRYAAAAASUVORK5CYII=","sizes":"(max-width: 800px) 100vw, 800px","src":"/static/8fd75a9f9cfdfeeaa6be9a38e0299da3/f2687/react-loadable.png","srcSet":"/static/8fd75a9f9cfdfeeaa6be9a38e0299da3/72352/react-loadable.png 200w,\n/static/8fd75a9f9cfdfeeaa6be9a38e0299da3/34595/react-loadable.png 400w,\n/static/8fd75a9f9cfdfeeaa6be9a38e0299da3/f2687/react-loadable.png 800w,\n/static/8fd75a9f9cfdfeeaa6be9a38e0299da3/1e56d/react-loadable.png 1200w,\n/static/8fd75a9f9cfdfeeaa6be9a38e0299da3/35bb1/react-loadable.png 1600w,\n/static/8fd75a9f9cfdfeeaa6be9a38e0299da3/d9f2b/react-loadable.png 1780w"}}}},"fields":{"slug":"/development-isomorphic-spa-using-react-part3/"}},"next":{"id":"d9aa4ac7-4503-533a-88a4-4fa54fe87bda","excerpt":"처음 TypeScript를 접하고 사용해보면서 개인적으로 꼭 배워보고 싶은 언어(언어라고 표헌하긴 애매할 수 있지만 딱히 다른 단어가 떠오르지 않는다)라서 생각해서 개인적인 프로젝트 진행 시 TypeScript를 사용하려 노력했다. 아직 부족한 부분이 많고 앞으로도 계속 공부할 생각이며, 우선 지금까지 TypeScript…","frontmatter":{"title":"TypeScript를 활용한 JQuery 프로젝트 리팩토링 - 1부","date":"2019.01.03","tags":["javascript","typescript"],"translation":null,"mainImage":{"childImageSharp":{"sizes":{"aspectRatio":4.644444444444445,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAu0lEQVQI12P4Dwf//nx/Nefr08bvz5t/vJ7w+/dnoNiWa29spl7wnnvZavL5DVfeAEX+/PsH18EA0QfC/35/epD19rrj80su725GnHv6Yv+DHz37HzLk7JVsOs6Qt2/ioSdAZb//YtP89+/vXy8KLh9wntBuc2xL+NwLj+LXPm3adV+57dSck88z195adu4VTpuBmn++qNiw2GP2RI8V82P+//8AFJx05Ilg7dGklTfz1t8+dBck8hdJMwCufMceRlNXxQAAAABJRU5ErkJggg==","sizes":"(max-width: 627px) 100vw, 627px","src":"/static/7efe42f8fd8abc98b571ad70a37be453/cbe3e/refactoring-ts.png","srcSet":"/static/7efe42f8fd8abc98b571ad70a37be453/652e8/refactoring-ts.png 200w,\n/static/7efe42f8fd8abc98b571ad70a37be453/d1d17/refactoring-ts.png 400w,\n/static/7efe42f8fd8abc98b571ad70a37be453/cbe3e/refactoring-ts.png 627w"}}}},"fields":{"slug":"/jquery-project-refactoring-using-typescript-part1/"}}}}